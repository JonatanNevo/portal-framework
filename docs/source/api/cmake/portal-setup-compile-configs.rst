.. _portal-setup-compile-configs:

Function portal_setup_compile_configs
-------------------------------------

Generates a single implementation file providing definitions for application configuration
constants declared across all dependent Portal modules.

This function creates a C++ source file that defines compile-time constants for application
metadata (display name, settings file, icon file). These definitions satisfy the ``extern const``
declarations that each Portal module creates via ``portal_setup_config_pch`` in their respective
config PCHs. This allows a single implementation to serve all dependent modules.

Synopsis
^^^^^^^^

.. code-block:: cmake

  portal_setup_compile_configs(<target_name>
                                <application_name>
                                <settings_file>
                                <icon_file>)

Arguments
^^^^^^^^^

``<target_name>``
  Name of the executable target to add the configuration definitions to.

``<application_name>``
  Display name of the application (e.g., "My Game"). Becomes the definition
  for the ``portal::PORTAL_APPLICATION_NAME`` constant declared in each module's config PCH.

``<settings_file>``
  Filename of the settings file (e.g., "settings.json"). Becomes the definition
  for the ``portal::PORTAL_SETTINGS_FILE_NAME`` constant declared in each module's config PCH.

``<icon_file>``
  Filename of the icon file (e.g., "icon.png"). Becomes the definition for
  the ``portal::PORTAL_ICON_FILE_NAME`` constant declared in each module's config PCH.

Behavior
^^^^^^^^

The function performs the following operations:

1. **Template Generation**: Creates a C++ source file template containing definitions
   for ``PORTAL_APPLICATION_NAME``, ``PORTAL_SETTINGS_FILE_NAME``, and ``PORTAL_ICON_FILE_NAME``
   as ``constexpr std::string_view`` in the ``portal`` namespace.

2. **CMake Configuration**: Writes the template to ``config_impl.inc`` in the build
   directory, then uses ``configure_file()`` to substitute ``@VARIABLE@`` placeholders
   with the provided values, producing ``config_impl.cpp``.

3. **Source Integration**: Adds the generated ``config_impl.cpp`` to the target's
   private sources, providing a single set of definitions that satisfy the declarations
   from all dependent Portal modules.

Multi-Module Declaration Pattern
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Each Portal module (core, application, engine, etc.) that has a config file calls
``portal_setup_config_pch`` during its build, which generates declarations for these
constants in the module's config PCH:

.. code-block:: cpp

  // In portal-core/config.h (generated by portal_setup_config_pch)
  namespace portal {
      extern constexpr std::string_view PORTAL_APPLICATION_NAME;
  }

  // In portal-application/config.h (also generated by portal_setup_config_pch)
  namespace portal {
      extern constexpr std::string_view PORTAL_SETTINGS_FILE_NAME;
  }

  // In portal-engine/config.h (also generated by portal_setup_config_pch)
  namespace portal {
      extern constexpr std::string_view PORTAL_ICON_FILE_NAME;
  }

The application then calls ``portal_setup_compile_configs`` **once** to provide the single
implementation that all modules will link against:

.. code-block:: cpp

  // In build/config_impl.cpp (generated by portal_setup_compile_configs)
  namespace portal {
      constexpr std::string_view PORTAL_APPLICATION_NAME = "My Game";
      constexpr std::string_view PORTAL_SETTINGS_FILE_NAME = "settings.json";
      constexpr std::string_view PORTAL_ICON_FILE_NAME = "icon.png";
  }

Example Usage
^^^^^^^^^^^^^

Typically called internally by :ref:`portal_add_game <portal-add-game>`:

.. code-block:: cmake

  # Each Portal module has already called portal_setup_config_pch during their build
  # Application calls this once to provide the definitions
  portal_setup_compile_configs(my-game "My Game" "settings.json" "icon.png")

Application code in any module can then use these constants:

.. code-block:: cpp

  // In any source file from portal-core, portal-application, portal-engine, or the app
  #include <my_game/config.h>

  void logAppInfo() {
      // All modules see the same values
      std::cout << "App: " << portal::PORTAL_APPLICATION_NAME << std::endl;
  }

Notes
^^^^^

- This is an internal function typically called by :ref:`portal_add_game <portal-add-game>`
- Provides a single implementation for declarations across all dependent Portal modules

See Also
^^^^^^^^

- :ref:`portal_setup_config_pch <portal-setup-config-pch>`: Generates config PCH with variable declarations (called per module)
- :ref:`portal_add_game <portal-add-game>`: Creates Portal Engine game executables
- :ref:`portal_read_settings <portal-read-settings>`: Reads and processes settings files